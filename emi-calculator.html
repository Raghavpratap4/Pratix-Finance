<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EMI Calculator - Pratix Finance</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      background-color: #0f172a;
      color: white;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      transition: all 0.3s ease;
    }

    body.light-mode {
      background-color: #f9f9f9 !important;
      color: #111 !important;
    }

    body.light-mode h1,
    body.light-mode h3,
    body.light-mode label,
    body.light-mode strong,
    body.light-mode span,
    body.light-mode p {
      color: #111 !important;
    }

    body.light-mode .container {
      background-color: #ffffff !important;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    body.light-mode input,
    body.light-mode select {
      background-color: #ffffff !important;
      color: #111 !important;
      border: 1px solid #ccc !important;
    }

    body.light-mode button {
      background-color: #2563eb !important;
      color: #ffffff !important;
      border: 1px solid #2563eb !important;
    }

    body.light-mode .results,
    body.light-mode .schedule {
      background-color: #f3f4f6 !important;
    }

    body.light-mode canvas {
      background-color: #ffffff !important;
    }

    body.light-mode th {
      background-color: #2563eb !important;
      color: #ffffff !important;
    }

    body.light-mode td {
      color: #111 !important;
    }

    body.light-mode .footer {
      color: #444 !important;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: #1e293b;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 20px #38bdf8;
    }

    h1 {
      font-size: 2.2rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 1rem;
      background: linear-gradient(to right, #38bdf8, #facc15);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    body.light-mode h1 {
      background: linear-gradient(to right, #0ea5e9, #eab308);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    label {
      margin-top: 1rem;
      display: block;
      font-weight: bold;
    }

    input, select {
      width: 100%;
      padding: 0.8rem;
      margin-top: 0.5rem;
      border: none;
      border-radius: 8px;
      background: #334155;
      color: white;
      font-size: 1rem;
    }

    button {
      background: #38bdf8;
      color: #0f172a;
      padding: 1rem;
      border: none;
      width: 100%;
      margin-top: 1.5rem;
      font-size: 1.1rem;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    button:hover {
      background: #0ea5e9;
      transform: translateY(-2px);
    }

    .results, .schedule {
      margin-top: 2rem;
      background: #1e293b;
      padding: 1rem;
      border-radius: 10px;
    }

    canvas {
      margin-top: 20px;
      background: #0f172a;
      border-radius: 10px;
      height: 220px !important;
      max-width: 100%;
    }

    table {
      width: 100%;
      margin-top: 1rem;
      border-collapse: collapse;
      color: white;
    }

    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #334155;
    }

    th {
      background: #38bdf8;
      color: #0f172a;
    }

    .footer {
      margin-top: 2rem;
      text-align: center;
      font-size: 0.9rem;
      color: #94a3b8;
    }

    .prepayment-section {
      display: none;
      margin-top: 10px;
    }

    .flex-row {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .header-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .language-selector {
      background: #334155;
      color: white;
      border: none;
      padding: 0.5rem;
      border-radius: 6px;
      cursor: pointer;
    }

    body.light-mode .language-selector {
      background: #ffffff;
      color: #111;
      border: 1px solid #ccc;
    }

    .theme-toggle {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: white;
      padding: 0.5rem;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    body.light-mode .theme-toggle {
      color: #111;
    }

    .theme-toggle:hover {
      background: rgba(56, 189, 248, 0.2);
    }

    .logo-container {
      text-align: center;
      margin-bottom: 1rem;
    }

    .logo {
      height: 60px;
      vertical-align: middle;
      margin-right: 10px;
    }

    .pdf-export {
      text-align: center;
      margin: 30px 0;
    }

    .pdf-btn {
      padding: 10px 20px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .pdf-btn:hover {
      background: #1d4ed8;
      transform: translateY(-2px);
    }

    #pdfExportSection {
      padding: 40px;
      font-family: 'Segoe UI', sans-serif;
      display: none;
      background: white;
      color: black;
    }
  </style>
</head>
<body class="dark-mode">

<div class="container">
  <div class="header-controls">
    <select id="languageSelector" class="language-selector" onchange="translateUI(this.value)">
      <option value="en">English</option>
      <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
      <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
      <option value="fr">Fran√ßais</option>
      <option value="es">Espa√±ol</option>
      <option value="de">Deutsch</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="ja">Êó•Êú¨Ë™û</option>
      <option value="ko">ÌïúÍµ≠Ïñ¥</option>
    </select>
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">üåü</button>
  </div>

  <div class="logo-container">
    <img src="https://placehold.co/60x60/38bdf8/ffffff?text=PF" alt="Logo" class="logo" onerror="this.style.display='none'">
    <h1 id="title">EMI Calculator</h1>
  </div>

  <label><span id="label-loanAmt">Loan Amount (‚Çπ)</span></label>
  <input type="number" id="loanAmount" value="500000" />

  <label><span id="label-interest">Annual Interest Rate (%)</span></label>
  <input type="number" id="interestRate" value="8.5" step="0.1" />

  <label><span id="label-tenure">Loan Tenure</span></label>
  <div class="flex-row">
    <input type="number" id="loanTenure" value="5" />
    <select id="tenureUnit">
      <option value="years" selected>Years</option>
      <option value="months">Months</option>
    </select>
  </div>

  <label><span id="label-enable">Enable Prepayment?</span></label>
  <select id="enablePrepayment" onchange="togglePrepay()">
    <option value="no">No</option>
    <option value="yes">Yes</option>
  </select>

  <div class="prepayment-section" id="prepaymentSection">
    <label><span id="label-prepayAmt">Prepayment Amount (‚Çπ)</span></label>
    <input type="number" id="prepaymentAmount" value="100000" />
    <label><span id="label-prepayAfter">Prepay After (Months)</span></label>
    <input type="number" id="prepaymentMonth" value="12" />
  </div>

  <label><span id="label-recurring">Recurring Prepayment Amount (‚Çπ/year)</span></label>
  <input type="number" id="recurringPrepay" value="0" />

  <label><span id="label-chart">Chart Type</span></label>
  <select id="chartType" onchange="renderChart()">
    <option value="pie">Pie</option>
    <option value="bar">Bar</option>
    <option value="line">Line</option>
  </select>

  <button onclick="calculateEMI(); buttonClickEffect(this);" id="calculateBtn">Calculate EMI</button>

  <div class="results">
    <p><strong>Monthly EMI:</strong> ‚Çπ<span id="monthlyEmi">0</span></p>
    <p><strong>Total Interest:</strong> ‚Çπ<span id="totalInterest">0</span></p>
    <p><strong>Total Payment:</strong> ‚Çπ<span id="totalPayment">0</span></p>
    <p><strong><span id="label-saved">Interest Saved:</span></strong> ‚Çπ<span id="interestSaved">0</span></p>
    <p><strong><span id="label-reduced">Tenure Reduced:</span></strong> <span id="tenureReduced">0</span> months</p>
  </div>

  <div style="max-width: 450px; margin: 20px auto;">
    <canvas id="emiChart"></canvas>
  </div>

  <div class="schedule">
    <h3 id="label-schedule">EMI Schedule</h3>
    <table id="scheduleTable"></table>
  </div>

  <div class="pdf-export">
    <button class="pdf-btn" onclick="generateVisualPDF()">
      üìÑ Download PDF Report
    </button>
  </div>

  <div class="footer">¬© 2025 Pratix Finance ‚Äî All rights reserved</div>
</div>

<!-- PDF Export Section -->
<div id="pdfExportSection">
  <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 25px;">
    <img src="https://placehold.co/60x60/38bdf8/ffffff?text=PF" style="height: 60px;">
    <h1 style="font-size: 2rem; margin: 0;">
      <span style="color: black; font-weight: 700;">Pratix</span>
      <span style="background: linear-gradient(to right, #3b82f6, #facc15); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700;">Finance</span>
    </h1>
  </div>

  <div style="display: flex; flex-wrap: wrap; gap: 40px; margin-bottom: 30px; font-size: 16px; font-weight: 500; background: #f3f4f6; padding: 20px; border-radius: 10px;">
    <div style="flex: 1; min-width: 250px;">
      <p><strong>Loan Amount:</strong> ‚Çπ<span id="pdf-loanAmount">0</span></p>
      <p><strong>Annual Interest:</strong> <span id="pdf-interestRate">0</span>%</p>
      <p><strong>Prepayment Amount:</strong> ‚Çπ<span id="pdf-prepaymentAmount">0</span></p>
    </div>
    <div style="flex: 1; min-width: 250px;">
      <p><strong>Loan Tenure:</strong> <span id="pdf-loanTenure">0</span> <span id="pdf-tenureUnit">Years</span></p>
    </div>
  </div>

  <div style="background: #f1f5f9; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
    <p><strong>Monthly EMI:</strong> ‚Çπ<span id="pdf-emi">0</span></p>
    <p><strong>Total Interest:</strong> ‚Çπ<span id="pdf-totalInterest">0</span></p>
    <p><strong>Total Payment:</strong> ‚Çπ<span id="pdf-totalPayment">0</span></p>
    <p><strong>Interest Saved:</strong> ‚Çπ<span id="pdf-interestSaved">0</span></p>
  </div>

  <div style="border: 1px solid #ddd; padding: 20px; border-radius: 10px;">
    <canvas id="pdfChart" width="400" height="300" style="margin: 0 auto; display: block;"></canvas>
    <div style="display: flex; justify-content: center; gap: 40px; margin-top: 10px; font-size: 14px;">
      <div><span style="color: #facc15;">‚ñ†</span> Total Interest</div>
      <div><span style="color: #3b82f6;">‚ñ†</span> Principal Amount</div>
    </div>
  </div>
</div>

<script>
let chartInstance = null;

// Translation object
const translations = {
  en: {
    loanAmt: "Loan Amount (‚Çπ)",
    interest: "Annual Interest Rate (%)",
    tenure: "Loan Tenure",
    enable: "Enable Prepayment?",
    prepayAmt: "Prepayment Amount (‚Çπ)",
    prepayAfter: "Prepay After (Months)",
    recurring: "Recurring Prepayment Amount (‚Çπ/year)",
    chart: "Chart Type",
    schedule: "EMI Schedule",
    title: "EMI Calculator",
    btn: "Calculate EMI",
    saved: "Interest Saved:",
    reduced: "Tenure Reduced:"
  },
  hi: {
    loanAmt: "‡§ã‡§£ ‡§∞‡§æ‡§∂‡§ø (‚Çπ)",
    interest: "‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§¶‡§∞ (%)",
    tenure: "‡§ã‡§£ ‡§Ö‡§µ‡§ß‡§ø",
    enable: "‡§™‡•ç‡§∞‡•Ä‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§ï‡§∞‡•á‡§Ç?",
    prepayAmt: "‡§™‡•ç‡§∞‡•Ä‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∞‡§æ‡§∂‡§ø (‚Çπ)",
    prepayAfter: "‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§™‡•ç‡§∞‡•Ä‡§™‡•á (‡§Æ‡§π‡•Ä‡§®‡•á)",
    recurring: "‡§Ü‡§µ‡§∞‡•ç‡§§‡•Ä ‡§™‡•ç‡§∞‡•Ä‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§∞‡§æ‡§∂‡§ø (‚Çπ/‡§µ‡§∞‡•ç‡§∑)",
    chart: "‡§ö‡§æ‡§∞‡•ç‡§ü ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞",
    schedule: "‡§à‡§è‡§Æ‡§Ü‡§à ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä",
    title: "‡§à‡§è‡§Æ‡§Ü‡§à ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü‡§∞",
    btn: "‡§à‡§è‡§Æ‡§Ü‡§à ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç",
    saved: "‡§¨‡§ö‡§§ ‡§¨‡•ç‡§Ø‡§æ‡§ú:",
    reduced: "‡§∏‡§Æ‡§Ø ‡§Ö‡§µ‡§ß‡§ø ‡§Æ‡•á‡§Ç ‡§ï‡§Æ‡•Ä:"
  },
  bn: {
    loanAmt: "‡¶ã‡¶£‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‚Çπ)",
    interest: "‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï ‡¶∏‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶π‡¶æ‡¶∞ (%)",
    tenure: "‡¶ã‡¶£‡ßá‡¶∞ ‡¶Æ‡ßá‡¶Ø‡¶º‡¶æ‡¶¶",
    enable: "‡¶™‡ßç‡¶∞‡¶ø‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶ï‡ßç‡¶∑‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®?",
    prepayAmt: "‡¶™‡ßç‡¶∞‡¶ø‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‚Çπ)",
    prepayAfter: "‡¶™‡¶∞‡ßá ‡¶™‡ßç‡¶∞‡¶ø‡¶™‡ßá (‡¶Æ‡¶æ‡¶∏)",
    recurring: "‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶¨‡ßÉ‡¶§‡ßç‡¶§ ‡¶™‡ßç‡¶∞‡¶ø‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ (‚Çπ/‡¶¨‡¶õ‡¶∞)",
    chart: "‡¶ö‡¶æ‡¶∞‡ßç‡¶ü‡ßá‡¶∞ ‡¶ß‡¶∞‡¶®",
    schedule: "‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶∏‡ßÇ‡¶ö‡¶ø",
    title: "‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶ï‡ßç‡¶Ø‡¶æ‡¶≤‡¶ï‡ßÅ‡¶≤‡ßá‡¶ü‡¶∞",
    btn: "‡¶á‡¶è‡¶Æ‡¶Ü‡¶á ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®",
    saved: "‡¶∏‡¶û‡ßç‡¶ö‡¶ø‡¶§ ‡¶∏‡ßÅ‡¶¶:",
    reduced: "‡¶ï‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá:"
  },
  fr: {
    loanAmt: "Montant du pr√™t (‚Çπ)",
    interest: "Taux d'int√©r√™t annuel (%)",
    tenure: "Dur√©e du pr√™t",
    enable: "Activer le pr√©paiement?",
    prepayAmt: "Montant du pr√©paiement (‚Çπ)",
    prepayAfter: "Pr√©payer apr√®s (mois)",
    recurring: "Montant de pr√©paiement r√©current (‚Çπ/an)",
    chart: "Type de graphique",
    schedule: "Calendrier EMI",
    title: "Calculateur EMI",
    btn: "Calculer EMI",
    saved: "Int√©r√™t √©conomis√©:",
    reduced: "Dur√©e r√©duite:"
  },
  es: {
    loanAmt: "Monto del pr√©stamo (‚Çπ)",
    interest: "Tasa de inter√©s anual (%)",
    tenure: "Plazo del pr√©stamo",
    enable: "¬øHabilitar prepago?",
    prepayAmt: "Monto de prepago (‚Çπ)",
    prepayAfter: "Prepagar despu√©s (meses)",
    recurring: "Monto de prepago recurrente (‚Çπ/a√±o)",
    chart: "Tipo de gr√°fico",
    schedule: "Cronograma EMI",
    title: "Calculadora EMI",
    btn: "Calcular EMI",
    saved: "Inter√©s ahorrado:",
    reduced: "Plazo reducido:"
  },
  de: {
    loanAmt: "Darlehensbetrag (‚Çπ)",
    interest: "J√§hrlicher Zinssatz (%)",
    tenure: "Darlehenslaufzeit",
    enable: "Vorauszahlung aktivieren?",
    prepayAmt: "Vorauszahlungsbetrag (‚Çπ)",
    prepayAfter: "Vorauszahlung nach (Monate)",
    recurring: "Wiederkehrender Vorauszahlungsbetrag (‚Çπ/Jahr)",
    chart: "Diagrammtyp",
    schedule: "EMI-Zeitplan",
    title: "EMI-Rechner",
    btn: "EMI berechnen",
    saved: "Zinsen gespart:",
    reduced: "Laufzeit reduziert:"
  },
  ru: {
    loanAmt: "–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞ (‚Çπ)",
    interest: "–ì–æ–¥–æ–≤–∞—è –ø—Ä–æ—Ü–µ–Ω—Ç–Ω–∞—è —Å—Ç–∞–≤–∫–∞ (%)",
    tenure: "–°—Ä–æ–∫ –∫—Ä–µ–¥–∏—Ç–∞",
    enable: "–í–∫–ª—é—á–∏—Ç—å –¥–æ—Å—Ä–æ—á–Ω–æ–µ –ø–æ–≥–∞—à–µ–Ω–∏–µ?",
    prepayAmt: "–°—É–º–º–∞ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è (‚Çπ)",
    prepayAfter: "–î–æ—Å—Ä–æ—á–Ω–æ–µ –ø–æ–≥–∞—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ (–º–µ—Å—è—Ü—ã)",
    recurring: "–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è —Å—É–º–º–∞ –¥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è (‚Çπ/–≥–æ–¥)",
    chart: "–¢–∏–ø –¥–∏–∞–≥—Ä–∞–º–º—ã",
    schedule: "–ì—Ä–∞—Ñ–∏–∫ EMI",
    title: "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä EMI",
    btn: "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å EMI",
    saved: "–°—ç–∫–æ–Ω–æ–º–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ–Ω—Ç—ã:",
    reduced: "–°—Ä–æ–∫ —É–º–µ–Ω—å—à–µ–Ω:"
  },
  ja: {
    loanAmt: "„É≠„Éº„É≥ÈáëÈ°ç (‚Çπ)",
    interest: "Âπ¥Âà© (%)",
    tenure: "„É≠„Éº„É≥ÊúüÈñì",
    enable: "ÂâçÊâï„ÅÑ„ÇíÊúâÂäπ„Å´„Åó„Åæ„Åô„ÅãÔºü",
    prepayAmt: "ÂâçÊâï„ÅÑÈáëÈ°ç (‚Çπ)",
    prepayAfter: "ÂâçÊâï„ÅÑÂæå (Êúà)",
    recurring: "ÂÆöÊúüÂâçÊâï„ÅÑÈáëÈ°ç (‚Çπ/Âπ¥)",
    chart: "„ÉÅ„É£„Éº„Éà„Çø„Ç§„Éó",
    schedule: "EMI„Çπ„Ç±„Ç∏„É•„Éº„É´",
    title: "EMIË®àÁÆóÊ©ü",
    btn: "EMI„ÇíË®àÁÆó",
    saved: "ÁØÄÁ¥Ñ„Åï„Çå„ÅüÂà©ÊÅØ:",
    reduced: "Áü≠Á∏Æ„Åï„Çå„ÅüÊúüÈñì:"
  },
  ko: {
    loanAmt: "ÎåÄÏ∂ú Í∏àÏï° (‚Çπ)",
    interest: "Ïó∞Í∞Ñ Ïù¥ÏûêÏú® (%)",
    tenure: "ÎåÄÏ∂ú Í∏∞Í∞Ñ",
    enable: "ÏÑ†Î∂àÏùÑ ÌôúÏÑ±ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?",
    prepayAmt: "ÏÑ†Î∂à Í∏àÏï° (‚Çπ)",
    prepayAfter: "ÏÑ†Î∂à ÌõÑ (Í∞úÏõî)",
    recurring: "Î∞òÎ≥µ ÏÑ†Î∂à Í∏àÏï° (‚Çπ/ÎÖÑ)",
    chart: "Ï∞®Ìä∏ Ïú†Ìòï",
    schedule: "EMI ÏùºÏ†ï",
    title: "EMI Í≥ÑÏÇ∞Í∏∞",
    btn: "EMI Í≥ÑÏÇ∞",
    saved: "Ï†àÏïΩÎêú Ïù¥Ïûê:",
    reduced: "Í∏∞Í∞Ñ Îã®Ï∂ï:"
  }
};

function translateUI(lang) {
  const t = translations[lang] || translations.en;
  
  document.getElementById("title").innerText = t.title;
  document.getElementById("label-loanAmt").innerText = t.loanAmt;
  document.getElementById("label-interest").innerText = t.interest;
  document.getElementById("label-tenure").innerText = t.tenure;
  document.getElementById("label-enable").innerText = t.enable;
  document.getElementById("label-prepayAmt").innerText = t.prepayAmt;
  document.getElementById("label-prepayAfter").innerText = t.prepayAfter;
  document.getElementById("label-recurring").innerText = t.recurring;
  document.getElementById("label-chart").innerText = t.chart;
  document.getElementById("label-schedule").innerText = t.schedule;
  document.getElementById("label-saved").innerText = t.saved;
  document.getElementById("label-reduced").innerText = t.reduced;
  document.getElementById("calculateBtn").innerText = t.btn;
}

function toggleTheme() {
  document.body.classList.toggle('light-mode');
  document.body.classList.toggle('dark-mode');
}

function buttonClickEffect(btn) {
  const originalColor = btn.style.backgroundColor;
  btn.style.backgroundColor = '#22c55e';
  setTimeout(() => {
    btn.style.backgroundColor = originalColor;
  }, 300);
}

function togglePrepay() {
  const prepaySection = document.getElementById("prepaymentSection");
  const enablePrepay = document.getElementById("enablePrepayment").value;
  prepaySection.style.display = enablePrepay === "yes" ? "block" : "none";
}

function calculateEMI() {
  const P = parseFloat(document.getElementById("loanAmount").value) || 0;
  const R = (parseFloat(document.getElementById("interestRate").value) || 0) / 100 / 12;
  const rawTenure = parseInt(document.getElementById("loanTenure").value) || 0;
  const unit = document.getElementById("tenureUnit").value;
  const originalN = unit === "years" ? rawTenure * 12 : rawTenure;
  let N = originalN;

  if (P <= 0 || R <= 0 || N <= 0) {
    alert("Please enter valid values for all fields.");
    return;
  }

  const enablePrepay = document.getElementById("enablePrepayment").value === "yes";
  const prepayAmount = enablePrepay ? (parseFloat(document.getElementById("prepaymentAmount").value) || 0) : 0;
  const prepayMonth = enablePrepay ? (parseInt(document.getElementById("prepaymentMonth").value) || 0) : 0;
  const recurringPrepay = parseFloat(document.getElementById("recurringPrepay").value) || 0;

  const EMI = (P * R * Math.pow(1 + R, N)) / (Math.pow(1 + R, N) - 1);
  let balance = P;
  let schedule = [];
  let totalInterest = 0;

  for (let i = 1; i <= N; i++) {
    const interest = balance * R;
    const principal = EMI - interest;
    balance -= principal;

    if (i === prepayMonth && prepayAmount > 0) {
      balance -= prepayAmount;
      if (balance < 0) balance = 0;
    }

    if (recurringPrepay > 0 && i % 12 === 0 && balance > 0) {
      balance -= recurringPrepay;
      if (balance < 0) balance = 0;
    }

    totalInterest += interest;
    schedule.push({
      month: i,
      emi: EMI.toFixed(2),
      principal: principal.toFixed(2),
      interest: interest.toFixed(2),
      balance: Math.max(0, balance).toFixed(2)
    });

    if (balance <= 0) break;
  }

  const totalPayment = EMI * schedule.length + (prepayMonth > 0 ? prepayAmount : 0) + (Math.floor(schedule.length / 12) * recurringPrepay);
  const originalEMI = (P * R * Math.pow(1 + R, originalN)) / (Math.pow(1 + R, originalN) - 1);
  const originalTotalPayment = originalEMI * originalN;
  const interestSaved = Math.max(0, originalTotalPayment - totalPayment);
  const tenureReduced = Math.max(0, originalN - schedule.length);

  document.getElementById("monthlyEmi").innerText = EMI.toFixed(2);
  document.getElementById("totalInterest").innerText = totalInterest.toFixed(2);
  document.getElementById("totalPayment").innerText = totalPayment.toFixed(2);
  document.getElementById("interestSaved").innerText = interestSaved.toFixed(2);
  document.getElementById("tenureReduced").innerText = tenureReduced;

  renderChart(P, totalInterest);
  showSchedule(schedule);
}

function renderChart(principal = 0, interest = 0) {
  const type = document.getElementById("chartType").value;
  const ctx = document.getElementById("emiChart").getContext("2d");

  if (chartInstance) {
    chartInstance.destroy();
  }

  const isLightMode = document.body.classList.contains('light-mode');
  const textColor = isLightMode ? '#111' : 'white';
  const gridColor = isLightMode ? '#ccc' : '#334155';

  chartInstance = new Chart(ctx, {
    type: type,
    data: {
      labels: ['Principal', 'Interest'],
      datasets: [{
        label: 'Amount (‚Çπ)',
        data: [principal, interest],
        backgroundColor: ['#38bdf8', '#facc15'],
        borderColor: '#38bdf8',
        fill: false,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          labels: {
            color: textColor
          }
        }
      },
      scales: (type === 'bar' || type === 'line') ? {
        x: {
          ticks: { color: textColor },
          grid: { color: gridColor }
        },
        y: {
          ticks: { color: textColor },
          grid: { color: gridColor }
        }
      } : {}
    }
  });
}

function showSchedule(schedule) {
  const table = document.getElementById("scheduleTable");
  table.innerHTML = `
    <thead>
      <tr>
        <th>Month</th>
        <th>EMI (‚Çπ)</th>
        <th>Principal</th>
        <th>Interest</th>
        <th>Balance</th>
      </tr>
    </thead>
    <tbody>
      ${schedule.slice(0, 12).map(row => `
        <tr>
          <td>${row.month}</td>
          <td>${row.emi}</td>
          <td>${row.principal}</td>
          <td>${row.interest}</td>
          <td>${row.balance}</td>
        </tr>
      `).join('')}
      ${schedule.length > 12 ? '<tr><td colspan="5">... and ' + (schedule.length - 12) + ' more rows</td></tr>' : ''}
    </tbody>
  `;
}

function generateVisualPDF() {
  // Copy values to PDF section
  document.getElementById("pdf-loanAmount").textContent = document.getElementById("loanAmount").value;
  document.getElementById("pdf-interestRate").textContent = document.getElementById("interestRate").value;
  document.getElementById("pdf-prepaymentAmount").textContent = document.getElementById("prepaymentAmount").value || 0;
  document.getElementById("pdf-loanTenure").textContent = document.getElementById("loanTenure").value;
  document.getElementById("pdf-tenureUnit").textContent = document.getElementById("tenureUnit").value;
  document.getElementById("pdf-emi").textContent = document.getElementById("monthlyEmi").textContent;
  document.getElementById("pdf-totalInterest").textContent = document.getElementById("totalInterest").textContent;
  document.getElementById("pdf-totalPayment").textContent = document.getElementById("totalPayment").textContent;
  document.getElementById("pdf-interestSaved").textContent = document.getElementById("interestSaved").textContent;

  // Render chart for PDF
  const ctx = document.getElementById('pdfChart').getContext('2d');
  const principal = parseFloat(document.getElementById("loanAmount").value) || 0;
  const totalInterest = parseFloat(document.getElementById("totalInterest").textContent.replace(/[^0-9.]/g, "")) || 0;

  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Principal', 'Total Interest'],
      datasets: [{
        label: 'EMI Breakdown',
        data: [principal, totalInterest],
        backgroundColor: ['#3b82f6', '#facc15']
      }]
    },
    options: {
      responsive: false,
      plugins: {
        legend: {
          display: false
        }
      }
    }
  });

  // Generate PDF after chart renders
  setTimeout(() => {
    const element = document.getElementById("pdfExportSection");
    const opt = {
      margin: 0.5,
      filename: 'EMI_Calculator_Report.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    };

    html2pdf().set(opt).from(element).save();
  }, 500);
}

// Initialize the application
window.addEventListener('load', function() {
  // Set default language based on browser
  const browserLang = navigator.language.slice(0, 2);
  const supportedLangs = Object.keys(translations);
  const selectedLang = supportedLangs.includes(browserLang) ? browserLang : "en";
  
  document.getElementById("languageSelector").value = selectedLang;
  translateUI(selectedLang);
  
  // Initialize other components
  togglePrepay();
  calculateEMI();
});
</script>

</body>
</html>